{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nlet UserSettingsComponent = class UserSettingsComponent {\n  constructor(authService, formBuilder) {\n    this.authService = authService;\n    this.formBuilder = formBuilder;\n    // Initialize currentUser with default values to avoid null/undefined issues\n    this.currentUser = {\n      email: '',\n      username: '',\n      id: null\n      // Add other properties if necessary\n    };\n\n    this.loading = false;\n    this.errorMessage = '';\n    this.successMessage = '';\n    this.imagePreviewUrl = null;\n  }\n  ngOnInit() {\n    this.initializeForm();\n    this.loadCurrentUser();\n  }\n  loadCurrentUser() {\n    const userId = localStorage.getItem('userId');\n    if (userId) {\n      this.authService.getUserDetails(+userId).subscribe({\n        next: user => {\n          this.currentUser = user;\n          this.updateFormValues(user);\n        },\n        error: err => {\n          console.error('Error fetching user details:', err);\n        }\n      });\n    } else {\n      console.error('User ID not found in local storage');\n    }\n  }\n  initializeForm() {\n    this.settingsForm = this.formBuilder.group({\n      email: ['', [Validators.required, Validators.email]],\n      username: ['', Validators.required],\n      password: ['', [Validators.minLength(8)]]\n    });\n  }\n  updateFormValues(user) {\n    this.settingsForm.patchValue({\n      email: user.email,\n      username: user.username\n      // Update other form controls here if needed\n    });\n  }\n\n  onUpdateSettings() {\n    if (this.settingsForm.valid) {\n      this.loading = true;\n      let updatedUserData = this.settingsForm.value;\n      // Check if password is empty, if so, remove it from the update payload\n      if (!updatedUserData.password) {\n        delete updatedUserData.password;\n      }\n      // Add the user ID to the update payload\n      updatedUserData = {\n        ...updatedUserData,\n        id: this.currentUser.id\n      };\n      this.authService.updateUserDetails(this.currentUser.id, updatedUserData).subscribe({\n        next: response => {\n          console.log('User settings updated', response);\n          this.loading = false;\n          this.successMessage = 'Update successful!';\n          this.currentUser = {\n            ...this.currentUser,\n            ...updatedUserData\n          };\n        },\n        error: err => {\n          this.errorMessage = 'Error updating user settings';\n          console.error('Error updating user settings:', err);\n          this.loading = false;\n        }\n      });\n    }\n  }\n  onProfilePictureChange(event) {\n    const element = event.currentTarget;\n    let fileList = element.files;\n    if (fileList && fileList.length > 0) {\n      this.selectedFile = fileList[0];\n      // Create a URL for the selected file\n      const fileReader = new FileReader();\n      fileReader.onload = () => {\n        if (fileReader.result) {\n          this.imagePreviewUrl = fileReader.result;\n        }\n      };\n      fileReader.readAsDataURL(this.selectedFile);\n    }\n  }\n  get isAuthenticated() {\n    return this.authService.isAuthenticated();\n  }\n  logout() {\n    this.authService.logout();\n  }\n};\nUserSettingsComponent = __decorate([Component({\n  selector: 'app-user-settings',\n  templateUrl: './user-settings.component.html',\n  styleUrls: ['./user-settings.component.css']\n})], UserSettingsComponent);\nexport { UserSettingsComponent };","map":{"version":3,"mappings":";AAAA,SAASA,SAAS,QAAgB,eAAe;AACjD,SAAiCC,UAAU,QAAQ,gBAAgB;AAQ5D,IAAMC,qBAAqB,GAA3B,MAAMA,qBAAqB;EAchCC,YACUC,WAAwB,EACxBC,WAAwB;IADxB,gBAAW,GAAXD,WAAW;IACX,gBAAW,GAAXC,WAAW;IAfrB;IACA,gBAAW,GAAQ;MACjBC,KAAK,EAAE,EAAE;MACTC,QAAQ,EAAE,EAAE;MACZC,EAAE,EAAE;MACJ;KACD;;IAED,YAAO,GAAG,KAAK;IACf,iBAAY,GAAW,EAAE;IACzB,mBAAc,GAAW,EAAE;IAkF3B,oBAAe,GAAkB,IAAI;EA5ElC;EAEHC,QAAQ;IACN,IAAI,CAACC,cAAc,EAAE;IACrB,IAAI,CAACC,eAAe,EAAE;EACxB;EAEQA,eAAe;IACrB,MAAMC,MAAM,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;IAC7C,IAAIF,MAAM,EAAE;MACV,IAAI,CAACR,WAAW,CAACW,cAAc,CAAC,CAACH,MAAM,CAAC,CAACI,SAAS,CAAC;QACjDC,IAAI,EAAGC,IAAI,IAAI;UACb,IAAI,CAACC,WAAW,GAAGD,IAAI;UACvB,IAAI,CAACE,gBAAgB,CAACF,IAAI,CAAC;QAC7B,CAAC;QACDG,KAAK,EAAGC,GAAG,IAAI;UACbC,OAAO,CAACF,KAAK,CAAC,8BAA8B,EAAEC,GAAG,CAAC;QACpD;OACD,CAAC;KACH,MAAM;MACLC,OAAO,CAACF,KAAK,CAAC,oCAAoC,CAAC;;EAEvD;EAEQX,cAAc;IACpB,IAAI,CAACc,YAAY,GAAG,IAAI,CAACnB,WAAW,CAACoB,KAAK,CAAC;MACzCnB,KAAK,EAAE,CAAC,EAAE,EAAE,CAACL,UAAU,CAACyB,QAAQ,EAAEzB,UAAU,CAACK,KAAK,CAAC,CAAC;MACpDC,QAAQ,EAAE,CAAC,EAAE,EAAEN,UAAU,CAACyB,QAAQ,CAAC;MACnCC,QAAQ,EAAE,CAAC,EAAE,EAAE,CAAC1B,UAAU,CAAC2B,SAAS,CAAC,CAAC,CAAC,CAAC;KACzC,CAAC;EACJ;EAEQR,gBAAgB,CAACF,IAAS;IAChC,IAAI,CAACM,YAAY,CAACK,UAAU,CAAC;MAC3BvB,KAAK,EAAEY,IAAI,CAACZ,KAAK;MACjBC,QAAQ,EAAEW,IAAI,CAACX;MACf;KACD,CAAC;EACJ;;EAEAuB,gBAAgB;IACd,IAAI,IAAI,CAACN,YAAY,CAACO,KAAK,EAAE;MAC3B,IAAI,CAACC,OAAO,GAAG,IAAI;MACnB,IAAIC,eAAe,GAAG,IAAI,CAACT,YAAY,CAACU,KAAK;MAE7C;MACA,IAAI,CAACD,eAAe,CAACN,QAAQ,EAAE;QAC7B,OAAOM,eAAe,CAACN,QAAQ;;MAGjC;MACAM,eAAe,GAAG;QAChB,GAAGA,eAAe;QAClBzB,EAAE,EAAE,IAAI,CAACW,WAAW,CAACX;OACtB;MAED,IAAI,CAACJ,WAAW,CAAC+B,iBAAiB,CAAC,IAAI,CAAChB,WAAW,CAACX,EAAE,EAAEyB,eAAe,CAAC,CAACjB,SAAS,CAAC;QACjFC,IAAI,EAAGmB,QAAQ,IAAI;UACjBb,OAAO,CAACc,GAAG,CAAC,uBAAuB,EAAED,QAAQ,CAAC;UAC9C,IAAI,CAACJ,OAAO,GAAG,KAAK;UACpB,IAAI,CAACM,cAAc,GAAG,oBAAoB;UAE1C,IAAI,CAACnB,WAAW,GAAG;YACjB,GAAG,IAAI,CAACA,WAAW;YACnB,GAAGc;WACJ;QACH,CAAC;QACDZ,KAAK,EAAGC,GAAG,IAAI;UACb,IAAI,CAACiB,YAAY,GAAG,8BAA8B;UAClDhB,OAAO,CAACF,KAAK,CAAC,+BAA+B,EAAEC,GAAG,CAAC;UACnD,IAAI,CAACU,OAAO,GAAG,KAAK;QACtB;OACD,CAAC;;EAEN;EAIAQ,sBAAsB,CAACC,KAAY;IACjC,MAAMC,OAAO,GAAGD,KAAK,CAACE,aAAiC;IACvD,IAAIC,QAAQ,GAAoBF,OAAO,CAACG,KAAK;IAC7C,IAAID,QAAQ,IAAIA,QAAQ,CAACE,MAAM,GAAG,CAAC,EAAE;MACnC,IAAI,CAACC,YAAY,GAAGH,QAAQ,CAAC,CAAC,CAAC;MAE/B;MACA,MAAMI,UAAU,GAAG,IAAIC,UAAU,EAAE;MACnCD,UAAU,CAACE,MAAM,GAAG,MAAK;QACvB,IAAIF,UAAU,CAACG,MAAM,EAAE;UACrB,IAAI,CAACC,eAAe,GAAGJ,UAAU,CAACG,MAAgB;;MAEtD,CAAC;MACDH,UAAU,CAACK,aAAa,CAAC,IAAI,CAACN,YAAY,CAAC;;EAE/C;EAEA,IAAIO,eAAe;IACjB,OAAO,IAAI,CAAClD,WAAW,CAACkD,eAAe,EAAE;EAC3C;EAEAC,MAAM;IACJ,IAAI,CAACnD,WAAW,CAACmD,MAAM,EAAE;EAC3B;CAGD;AAzHYrD,qBAAqB,eALjCF,SAAS,CAAC;EACTwD,QAAQ,EAAE,mBAAmB;EAC7BC,WAAW,EAAE,gCAAgC;EAC7CC,SAAS,EAAE,CAAC,+BAA+B;CAC5C,CAAC,GACWxD,qBAAqB,CAyHjC;SAzHYA,qBAAqB","names":["Component","Validators","UserSettingsComponent","constructor","authService","formBuilder","email","username","id","ngOnInit","initializeForm","loadCurrentUser","userId","localStorage","getItem","getUserDetails","subscribe","next","user","currentUser","updateFormValues","error","err","console","settingsForm","group","required","password","minLength","patchValue","onUpdateSettings","valid","loading","updatedUserData","value","updateUserDetails","response","log","successMessage","errorMessage","onProfilePictureChange","event","element","currentTarget","fileList","files","length","selectedFile","fileReader","FileReader","onload","result","imagePreviewUrl","readAsDataURL","isAuthenticated","logout","selector","templateUrl","styleUrls"],"sourceRoot":"","sources":["/Users/brageeilertsen/RiderProjects/AngularBevgobs1/AngularBevgobs/ClientApp/src/app/user-settings/user-settings.component.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { AuthService } from 'src/app/services/authentication.service';\n\n@Component({\n  selector: 'app-user-settings',\n  templateUrl: './user-settings.component.html',\n  styleUrls: ['./user-settings.component.css']\n})\nexport class UserSettingsComponent implements OnInit {\n  // Initialize currentUser with default values to avoid null/undefined issues\n  currentUser: any = {\n    email: '',\n    username: '',\n    id: null,\n    // Add other properties if necessary\n  };\n  settingsForm!: FormGroup;\n  loading = false;\n  errorMessage: string = '';\n  successMessage: string = '';\n  private selectedFile: File | undefined;\n\n  constructor(\n    private authService: AuthService,\n    private formBuilder: FormBuilder\n  ) {}\n\n  ngOnInit() {\n    this.initializeForm();\n    this.loadCurrentUser();\n  }\n\n  private loadCurrentUser() {\n    const userId = localStorage.getItem('userId');\n    if (userId) {\n      this.authService.getUserDetails(+userId).subscribe({\n        next: (user) => {\n          this.currentUser = user;\n          this.updateFormValues(user);\n        },\n        error: (err) => {\n          console.error('Error fetching user details:', err);\n        }\n      });\n    } else {\n      console.error('User ID not found in local storage');\n    }\n  }\n\n  private initializeForm() {\n    this.settingsForm = this.formBuilder.group({\n      email: ['', [Validators.required, Validators.email]],\n      username: ['', Validators.required],\n      password: ['', [Validators.minLength(8)]]\n    });\n  }\n\n  private updateFormValues(user: any) {\n    this.settingsForm.patchValue({\n      email: user.email,\n      username: user.username\n      // Update other form controls here if needed\n    });\n  }\n\n  onUpdateSettings() {\n    if (this.settingsForm.valid) {\n      this.loading = true;\n      let updatedUserData = this.settingsForm.value;\n\n      // Check if password is empty, if so, remove it from the update payload\n      if (!updatedUserData.password) {\n        delete updatedUserData.password;\n      }\n\n      // Add the user ID to the update payload\n      updatedUserData = {\n        ...updatedUserData,\n        id: this.currentUser.id\n      };\n\n      this.authService.updateUserDetails(this.currentUser.id, updatedUserData).subscribe({\n        next: (response) => {\n          console.log('User settings updated', response);\n          this.loading = false;\n          this.successMessage = 'Update successful!';\n\n          this.currentUser = {\n            ...this.currentUser,\n            ...updatedUserData\n          };\n        },\n        error: (err) => {\n          this.errorMessage = 'Error updating user settings';\n          console.error('Error updating user settings:', err);\n          this.loading = false;\n        }\n      });\n    }\n  }\n\n  imagePreviewUrl: string | null = null;\n\n  onProfilePictureChange(event: Event): void {\n    const element = event.currentTarget as HTMLInputElement;\n    let fileList: FileList | null = element.files;\n    if (fileList && fileList.length > 0) {\n      this.selectedFile = fileList[0];\n\n      // Create a URL for the selected file\n      const fileReader = new FileReader();\n      fileReader.onload = () => {\n        if (fileReader.result) {\n          this.imagePreviewUrl = fileReader.result as string;\n        }\n      };\n      fileReader.readAsDataURL(this.selectedFile);\n    }\n  }\n\n  get isAuthenticated(): boolean {\n    return this.authService.isAuthenticated();\n  }\n\n  logout() {\n    this.authService.logout();\n  }\n\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}